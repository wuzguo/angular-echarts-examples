'use strict';

define([
    'workspace/workspace.module'
], function (workspaceModule) {

    // 定义指令
    workspaceModule.directive('mapScatterChart', function () {

        //初始化echarts图表
        var echeartOption = function (me) {
            var geoCoordMap = {
                "合肥": [117.283042, 31.86119],
                "芜湖": [118.376451, 31.326319],
                "蚌埠": [117.363228, 32.939667],
                "淮南": [117.018329, 32.647574],
                "马鞍山": [118.507906, 31.689362],
                "淮北": [116.794664, 33.971707],
                "铜陵": [117.816576, 30.929935],
                "安庆": [117.043551, 30.50883],
                "黄山": [118.317325, 29.709239],
                "滁州": [118.316264, 32.303627],
                "阜阳": [115.819729, 32.896969],
                "宿州": [116.984084, 33.633891],
                "六安": [116.507676, 31.752889],
                "亳州": [115.782939, 33.869338],
                "池州": [117.489157, 30.656037],
                "宣城": [118.757995, 30.945667],
                "福州": [119.306239, 26.075302],
                "厦门": [118.11022, 24.490474],
                "莆田": [119.007558, 25.431011],
                "三明": [117.635001, 26.265444],
                "泉州": [118.589421, 24.908853],
                "漳州": [117.661801, 24.510897],
                "南平": [118.178459, 26.635627],
                "龙岩": [117.02978, 25.091603],
                "宁德": [119.527082, 26.65924],
                "兰州": [103.823557, 36.058039],
                "嘉峪关": [98.277304, 39.786529],
                "金昌": [102.187888, 38.514238],
                "白银": [104.173606, 36.54568],
                "天水": [105.724998, 34.578529],
                "武威": [102.634697, 37.929996],
                "张掖": [100.455472, 38.932897],
                "平凉": [106.684691, 35.54279],
                "酒泉": [98.510795, 39.744023],
                "庆阳": [107.638372, 35.734218],
                "定西": [104.626294, 35.579578],
                "陇南": [104.929379, 33.388598],
                "临夏": [103.212006, 35.599446],
                "甘南": [102.911008, 34.986354],
                "广州": [113.280637, 23.125178],
                "韶关": [113.591544, 24.801322],
                "深圳": [114.085947, 22.547],
                "珠海": [113.553986, 22.224979],
                "汕头": [116.708463, 23.37102],
                "佛山": [113.122717, 23.028762],
                "江门": [113.094942, 22.590431],
                "湛江": [110.364977, 21.274898],
                "茂名": [110.919229, 21.659751],
                "肇庆": [112.472529, 23.051546],
                "惠州": [114.412599, 23.079404],
                "梅州": [116.117582, 24.299112],
                "汕尾": [115.364238, 22.774485],
                "河源": [114.697802, 23.746266],
                "阳江": [111.975107, 21.859222],
                "清远": [113.051227, 23.685022],
                "东莞": [113.746262, 23.046237],
                "中山": [113.382391, 22.521113],
                "潮州": [116.632301, 23.661701],
                "揭阳": [116.355733, 23.543778],
                "云浮": [112.044439, 22.929801],
                "南宁": [108.320004, 22.82402],
                "柳州": [109.411703, 24.314617],
                "桂林": [110.299121, 25.274215],
                "梧州": [111.297604, 23.474803],
                "北海": [109.119254, 21.473343],
                "防城港": [108.345478, 21.614631],
                "钦州": [108.624175, 21.967127],
                "贵港": [109.602146, 23.0936],
                "玉林": [110.154393, 22.63136],
                "百色": [106.616285, 23.897742],
                "贺州": [111.552056, 24.414141],
                "河池": [108.062105, 24.695899],
                "来宾": [109.229772, 23.733766],
                "崇左": [107.353926, 22.404108],
                "贵阳": [106.713478, 26.578343],
                "六盘水": [104.846743, 26.584643],
                "遵义": [106.937265, 27.706626],
                "安顺": [105.932188, 26.245544],
                "铜仁": [109.191555, 27.718346],
                "黔西南": [104.897971, 25.08812],
                "毕节": [105.28501, 27.301693],
                "黔东南": [107.977488, 26.583352],
                "黔南": [107.517156, 26.258219],
                "海口": [110.33119, 20.031971],
                "三亚": [109.508268, 18.247872],
                "五指山": [109.516662, 18.776921],
                "琼海": [110.466785, 19.246011],
                "儋州": [109.576782, 19.517486],
                "文昌": [110.753975, 19.612986],
                "万宁": [110.388793, 18.796216],
                "东方": [108.653789, 19.10198],
                "定安县": [110.349235, 19.684966],
                "屯昌县": [110.102773, 19.362916],
                "澄迈县": [110.007147, 19.737095],
                "临高县": [109.687697, 19.908293],
                "白沙": [109.452606, 19.224584],
                "昌江": [109.053351, 19.260968],
                "乐东": [109.175444, 18.74758],
                "陵水": [110.037218, 18.505006],
                "保亭": [109.70245, 18.636371],
                "琼中": [109.839996, 19.03557],
                "石家庄": [114.502461, 38.045474],
                "唐山": [118.175393, 39.635113],
                "秦皇岛": [119.586579, 39.942531],
                "邯郸": [114.490686, 36.612273],
                "邢台": [114.508851, 37.0682],
                "保定": [115.482331, 38.867657],
                "张家口": [114.884091, 40.811901],
                "承德": [117.939152, 40.976204],
                "沧州": [116.857461, 38.310582],
                "廊坊": [116.704441, 39.523927],
                "衡水": [115.665993, 37.735097],
                "哈尔滨": [126.642464, 45.756967],
                "齐齐哈尔": [123.95792, 47.342081],
                "鸡西": [130.975966, 45.300046],
                "鹤岗": [130.277487, 47.332085],
                "双鸭山": [131.157304, 46.643442],
                "大庆": [125.11272, 46.590734],
                "伊春": [128.899396, 47.724775],
                "佳木斯": [130.361634, 46.809606],
                "七台河": [131.015584, 45.771266],
                "牡丹江": [129.618602, 44.582962],
                "黑河": [127.499023, 50.249585],
                "绥化": [126.99293, 46.637393],
                "大兴安岭": [124.711526, 52.335262],
                "郑州": [113.665412, 34.757975],
                "开封": [114.341447, 34.797049],
                "洛阳": [112.434468, 34.663041],
                "平顶山": [113.307718, 33.735241],
                "安阳": [114.352482, 36.103442],
                "鹤壁": [114.295444, 35.748236],
                "新乡": [113.883991, 35.302616],
                "焦作": [113.238266, 35.23904],
                "濮阳": [115.041299, 35.768234],
                "许昌": [113.826063, 34.022956],
                "漯河": [114.026405, 33.575855],
                "三门峡": [111.194099, 34.777338],
                "南阳": [112.540918, 32.999082],
                "商丘": [115.650497, 34.437054],
                "信阳": [114.075031, 32.123274],
                "周口": [114.649653, 33.620357],
                "驻马店": [114.024736, 32.980169],
                "济源": [112.590047, 35.090378],
                "武汉": [114.298572, 30.584355],
                "黄石": [115.077048, 30.220074],
                "十堰": [110.787916, 32.646907],
                "宜昌": [111.290843, 30.702636],
                "襄阳": [112.144146, 32.042426],
                "鄂州": [114.890593, 30.396536],
                "荆门": [112.204251, 31.03542],
                "孝感": [113.926655, 30.926423],
                "荆州": [112.23813, 30.326857],
                "黄冈": [114.879365, 30.447711],
                "咸宁": [114.328963, 29.832798],
                "随州": [113.37377, 31.717497],
                "恩施": [109.48699, 30.283114],
                "仙桃": [113.453974, 30.364953],
                "潜江": [112.896866, 30.421215],
                "天门": [113.165862, 30.653061],
                "神农架": [110.671525, 31.744449],
                "长沙": [112.982279, 28.19409],
                "株洲": [113.151737, 27.835806],
                "湘潭": [112.944052, 27.82973],
                "衡阳": [112.607693, 26.900358],
                "邵阳": [111.46923, 27.237842],
                "岳阳": [113.132855, 29.37029],
                "常德": [111.691347, 29.040225],
                "张家界": [110.479921, 29.127401],
                "益阳": [112.355042, 28.570066],
                "郴州": [113.032067, 25.793589],
                "永州": [111.608019, 26.434516],
                "怀化": [109.97824, 27.550082],
                "娄底": [112.008497, 27.728136],
                "湘西": [109.739735, 28.314296],
                "南京": [118.767413, 32.041544],
                "无锡": [120.301663, 31.574729],
                "徐州": [117.184811, 34.261792],
                "常州": [119.946973, 31.772752],
                "苏州": [120.619585, 31.299379],
                "南通": [120.864608, 32.016212],
                "连云港": [119.178821, 34.600018],
                "淮安": [119.021265, 33.597506],
                "盐城": [120.139998, 33.377631],
                "扬州": [119.421003, 32.393159],
                "镇江": [119.452753, 32.204402],
                "泰州": [119.915176, 32.484882],
                "宿迁": [118.275162, 33.963008],
                "南昌": [115.892151, 28.676493],
                "景德镇": [117.214664, 29.29256],
                "萍乡": [113.852186, 27.622946],
                "九江": [115.992811, 29.712034],
                "新余": [114.930835, 27.810834],
                "鹰潭": [117.033838, 28.238638],
                "赣州": [114.940278, 25.85097],
                "吉安": [114.986373, 27.111699],
                "宜春": [114.391136, 27.8043],
                "抚州": [116.358351, 27.98385],
                "上饶": [117.971185, 28.44442],
                "长春": [125.3245, 43.886841],
                "吉林": [126.55302, 43.843577],
                "四平": [124.370785, 43.170344],
                "辽源": [125.145349, 42.902692],
                "通化": [125.936501, 41.721177],
                "白山": [126.427839, 41.942505],
                "松原": [124.823608, 45.118243],
                "白城": [122.841114, 45.619026],
                "延边": [129.513228, 42.904823],
                "沈阳": [123.429096, 41.796767],
                "大连": [121.618622, 38.91459],
                "鞍山": [122.995632, 41.110626],
                "抚顺": [123.921109, 41.875956],
                "本溪": [123.770519, 41.297909],
                "丹东": [124.383044, 40.124296],
                "锦州": [121.135742, 41.119269],
                "营口": [122.235151, 40.667432],
                "阜新": [121.648962, 42.011796],
                "辽阳": [123.18152, 41.269402],
                "盘锦": [122.06957, 41.124484],
                "铁岭": [123.844279, 42.290585],
                "朝阳": [120.451176, 41.576758],
                "葫芦岛": [120.856394, 40.755572],
                "呼和浩特": [111.670801, 40.818311],
                "包头": [109.840405, 40.658168],
                "乌海": [106.825563, 39.673734],
                "赤峰": [118.956806, 42.275317],
                "通辽": [122.263119, 43.617429],
                "鄂尔多斯": [109.99029, 39.817179],
                "呼伦贝尔": [119.758168, 49.215333],
                "巴彦淖尔": [107.416959, 40.757402],
                "乌兰察布": [113.114543, 41.034126],
                "兴安盟": [122.070317, 46.076268],
                "锡林郭勒盟": [116.090996, 43.944018],
                "阿拉善盟": [105.706422, 38.844814],
                "银川": [106.278179, 38.46637],
                "石嘴山": [106.376173, 39.01333],
                "吴忠": [106.199409, 37.986165],
                "固原": [106.285241, 36.004561],
                "中卫": [105.189568, 37.514951],
                "西宁": [101.778916, 36.623178],
                "海东": [102.10327, 36.502916],
                "海北": [100.901059, 36.959435],
                "黄南": [102.019988, 35.517744],
                "海南": [100.619542, 36.280353],
                "果洛": [100.242143, 34.4736],
                "玉树": [97.008522, 33.004049],
                "海西": [97.370785, 37.374663],
                "济南": [117.000923, 36.675807],
                "青岛": [120.355173, 36.082982],
                "淄博": [118.047648, 36.814939],
                "枣庄": [117.557964, 34.856424],
                "东营": [118.66471, 37.434564],
                "烟台": [121.391382, 37.539297],
                "潍坊": [119.107078, 36.70925],
                "济宁": [116.587245, 35.415393],
                "泰安": [117.129063, 36.194968],
                "威海": [122.116394, 37.509691],
                "日照": [119.461208, 35.428588],
                "莱芜": [117.677736, 36.214397],
                "临沂": [118.326443, 35.065282],
                "德州": [116.307428, 37.453968],
                "聊城": [115.980367, 36.456013],
                "滨州": [118.016974, 37.383542],
                "菏泽": [115.469381, 35.246531],
                "太原": [112.549248, 37.857014],
                "大同": [113.295259, 40.09031],
                "阳泉": [113.583285, 37.861188],
                "长治": [113.113556, 36.191112],
                "晋城": [112.851274, 35.497553],
                "朔州": [112.433387, 39.331261],
                "晋中": [112.736465, 37.696495],
                "运城": [111.003957, 35.022778],
                "忻州": [112.733538, 38.41769],
                "临汾": [111.517973, 36.08415],
                "吕梁": [111.134335, 37.524366],
                "西安": [108.948024, 34.263161],
                "铜川": [108.979608, 34.916582],
                "宝鸡": [107.14487, 34.369315],
                "咸阳": [108.705117, 34.333439],
                "渭南": [109.502882, 34.499381],
                "延安": [109.49081, 36.596537],
                "汉中": [107.028621, 33.077668],
                "榆林": [109.741193, 38.290162],
                "安康": [109.029273, 32.6903],
                "商洛": [109.939776, 33.868319],
                "成都": [104.065735, 30.659462],
                "自贡": [104.773447, 29.352765],
                "攀枝花": [101.716007, 26.580446],
                "泸州": [105.443348, 28.889138],
                "德阳": [104.398651, 31.127991],
                "绵阳": [104.741722, 31.46402],
                "广元": [105.829757, 32.433668],
                "遂宁": [105.571331, 30.513311],
                "内江": [105.066138, 29.58708],
                "乐山": [103.761263, 29.582024],
                "南充": [106.082974, 30.795281],
                "眉山": [103.831788, 30.048318],
                "宜宾": [104.630825, 28.760189],
                "广安": [106.633369, 30.456398],
                "达州": [107.502262, 31.209484],
                "雅安": [103.001033, 29.987722],
                "巴中": [106.753669, 31.858809],
                "资阳": [104.641917, 30.122211],
                "阿坝": [102.221374, 31.899792],
                "甘孜": [101.963815, 30.050663],
                "凉山": [102.258746, 27.886762],
                "乌鲁木齐": [87.617733, 43.792818],
                "克拉玛依": [84.873946, 45.595886],
                "吐鲁番": [89.184078, 42.947613],
                "哈密": [93.51316, 42.833248],
                "昌吉": [87.304012, 44.014577],
                "博尔塔拉": [82.074778, 44.903258],
                "巴音郭楞": [86.150969, 41.768552],
                "阿克苏": [80.265068, 41.170712],
                "克孜勒苏": [76.172825, 39.713431],
                "喀什": [75.989138, 39.467664],
                "和田": [79.92533, 37.110687],
                "伊犁": [81.317946, 43.92186],
                "塔城": [82.985732, 46.746301],
                "阿勒泰": [88.13963, 47.848393],
                "石河子": [86.041075, 44.305886],
                "阿拉尔": [81.285884, 40.541914],
                "图木舒克": [79.077978, 39.867316],
                "五家渠": [87.526884, 44.167401],
                "北屯": [87.824932, 47.353177],
                "铁门关": [85.501218, 41.827251],
                "双河": [82.353656, 44.840524],
                "拉萨": [91.132212, 29.660361],
                "昌都": [97.178452, 31.136875],
                "山南": [91.766529, 29.236023],
                "日喀则": [88.885148, 29.267519],
                "那曲": [92.060214, 31.476004],
                "阿里": [80.105498, 32.503187],
                "林芝": [94.362348, 29.654693],
                "昆明": [102.712251, 25.040609],
                "曲靖": [103.797851, 25.501557],
                "玉溪": [102.543907, 24.350461],
                "保山": [99.167133, 25.111802],
                "昭通": [103.717216, 27.336999],
                "丽江": [100.233026, 26.872108],
                "普洱": [100.972344, 22.777321],
                "临沧": [100.08697, 23.886567],
                "楚雄": [101.546046, 25.041988],
                "红河": [103.384182, 23.366775],
                "文山": [104.24401, 23.36951],
                "西双版纳": [100.797941, 22.001724],
                "大理": [100.225668, 25.589449],
                "德宏": [98.578363, 24.436694],
                "怒江": [98.854304, 25.850949],
                "迪庆": [99.706463, 27.826853],
                "杭州": [120.153576, 30.287459],
                "宁波": [121.549792, 29.868388],
                "温州": [120.672111, 28.000575],
                "嘉兴": [120.750865, 30.762653],
                "湖州": [120.102398, 30.867198],
                "绍兴": [120.582112, 29.997117],
                "金华": [119.649506, 29.089524],
                "衢州": [118.87263, 28.941708],
                "舟山": [122.106863, 30.016028],
                "台州": [121.428599, 28.661378],
                "丽水": [119.921786, 28.451993],
                "台湾": [121.509062, 25.044332],
                "北京": [116.405285, 39.904989],
                "天津": [117.190182, 39.125596],
                "上海": [121.472644, 31.231706],
                "重庆": [106.504962, 29.533155],
                "香港": [114.173355, 22.320048],
                "澳门": [113.54909, 22.198951]
            };

            var data = [
                {name: '海门', value: 9},
                {name: '鄂尔多斯', value: 12},
                {name: '招远', value: 12},
                {name: '舟山', value: 12},
                {name: '齐齐哈尔', value: 14},
                {name: '盐城', value: 15},
                {name: '赤峰', value: 16},
                {name: '青岛', value: 18},
                {name: '乳山', value: 18},
                {name: '金昌', value: 19},
                {name: '泉州', value: 21},
                {name: '莱西', value: 21},
                {name: '日照', value: 21},
                {name: '胶南', value: 22},
                {name: '南通', value: 23},
                {name: '拉萨', value: 24},
                {name: '云浮', value: 24},
                {name: '梅州', value: 25},
                {name: '文登', value: 25},
                {name: '上海', value: 25},
                {name: '攀枝花', value: 25},
                {name: '威海', value: 25},
                {name: '承德', value: 25},
                {name: '厦门', value: 26},
                {name: '汕尾', value: 26},
                {name: '潮州', value: 26},
                {name: '丹东', value: 27},
                {name: '太仓', value: 27},
                {name: '曲靖', value: 27},
                {name: '烟台', value: 28},
                {name: '福州', value: 29},
                {name: '瓦房店', value: 30},
                {name: '即墨', value: 30},
                {name: '抚顺', value: 31},
                {name: '玉溪', value: 31},
                {name: '张家口', value: 31},
                {name: '阳泉', value: 31},
                {name: '莱州', value: 32},
                {name: '湖州', value: 32},
                {name: '汕头', value: 32},
                {name: '昆山', value: 33},
                {name: '宁波', value: 33},
                {name: '湛江', value: 33},
                {name: '揭阳', value: 34},
                {name: '荣成', value: 34},
                {name: '连云港', value: 35},
                {name: '葫芦岛', value: 35},
                {name: '常熟', value: 36},
                {name: '东莞', value: 36},
                {name: '河源', value: 36},
                {name: '淮安', value: 36},
                {name: '泰州', value: 36},
                {name: '南宁', value: 37},
                {name: '营口', value: 37},
                {name: '惠州', value: 37},
                {name: '江阴', value: 37},
                {name: '蓬莱', value: 37},
                {name: '韶关', value: 38},
                {name: '嘉峪关', value: 38},
                {name: '广州', value: 38},
                {name: '延安', value: 38},
                {name: '太原', value: 39},
                {name: '清远', value: 39},
                {name: '中山', value: 39},
                {name: '昆明', value: 39},
                {name: '寿光', value: 40},
                {name: '盘锦', value: 40},
                {name: '长治', value: 41},
                {name: '深圳', value: 41},
                {name: '珠海', value: 42},
                {name: '宿迁', value: 43},
                {name: '咸阳', value: 43},
                {name: '铜川', value: 44},
                {name: '平度', value: 44},
                {name: '佛山', value: 44},
                {name: '海口', value: 44},
                {name: '江门', value: 45},
                {name: '章丘', value: 45},
                {name: '肇庆', value: 46},
                {name: '大连', value: 47},
                {name: '临汾', value: 47},
                {name: '吴江', value: 47},
                {name: '石嘴山', value: 49},
                {name: '沈阳', value: 50},
                {name: '苏州', value: 50},
                {name: '茂名', value: 50},
                {name: '嘉兴', value: 51},
                {name: '长春', value: 51},
                {name: '胶州', value: 52},
                {name: '银川', value: 52},
                {name: '张家港', value: 52},
                {name: '三门峡', value: 53},
                {name: '锦州', value: 54},
                {name: '南昌', value: 54},
                {name: '柳州', value: 54},
                {name: '三亚', value: 54},
                {name: '自贡', value: 56},
                {name: '吉林', value: 56},
                {name: '阳江', value: 57},
                {name: '泸州', value: 57},
                {name: '西宁', value: 57},
                {name: '宜宾', value: 58},
                {name: '呼和浩特', value: 58},
                {name: '成都', value: 58},
                {name: '大同', value: 58},
                {name: '镇江', value: 59},
                {name: '桂林', value: 59},
                {name: '张家界', value: 59},
                {name: '宜兴', value: 59},
                {name: '北海', value: 60},
                {name: '西安', value: 61},
                {name: '金坛', value: 62},
                {name: '东营', value: 62},
                {name: '牡丹江', value: 63},
                {name: '遵义', value: 63},
                {name: '绍兴', value: 63},
                {name: '扬州', value: 64},
                {name: '常州', value: 64},
                {name: '潍坊', value: 65},
                {name: '重庆', value: 66},
                {name: '台州', value: 67},
                {name: '南京', value: 67},
                {name: '滨州', value: 70},
                {name: '贵阳', value: 71},
                {name: '无锡', value: 71},
                {name: '本溪', value: 71},
                {name: '克拉玛依', value: 72},
                {name: '渭南', value: 72},
                {name: '马鞍山', value: 72},
                {name: '宝鸡', value: 72},
                {name: '焦作', value: 75},
                {name: '句容', value: 75},
                {name: '北京', value: 79},
                {name: '徐州', value: 79},
                {name: '衡水', value: 80},
                {name: '包头', value: 80},
                {name: '绵阳', value: 80},
                {name: '乌鲁木齐', value: 84},
                {name: '枣庄', value: 84},
                {name: '杭州', value: 84},
                {name: '淄博', value: 85},
                {name: '鞍山', value: 86},
                {name: '溧阳', value: 86},
                {name: '库尔勒', value: 86},
                {name: '安阳', value: 90},
                {name: '开封', value: 90},
                {name: '济南', value: 92},
                {name: '德阳', value: 93},
                {name: '温州', value: 95},
                {name: '九江', value: 96},
                {name: '邯郸', value: 98},
                {name: '临安', value: 99},
                {name: '兰州', value: 99},
                {name: '沧州', value: 100},
                {name: '临沂', value: 103},
                {name: '南充', value: 104},
                {name: '天津', value: 105},
                {name: '富阳', value: 106},
                {name: '泰安', value: 112},
                {name: '诸暨', value: 112},
                {name: '郑州', value: 113},
                {name: '哈尔滨', value: 114},
                {name: '聊城', value: 116},
                {name: '芜湖', value: 117},
                {name: '唐山', value: 119},
                {name: '平顶山', value: 119},
                {name: '邢台', value: 119},
                {name: '德州', value: 120},
                {name: '济宁', value: 120},
                {name: '荆州', value: 127},
                {name: '宜昌', value: 130},
                {name: '义乌', value: 132},
                {name: '丽水', value: 133},
                {name: '洛阳', value: 134},
                {name: '秦皇岛', value: 136},
                {name: '株洲', value: 143},
                {name: '石家庄', value: 147},
                {name: '莱芜', value: 148},
                {name: '常德', value: 152},
                {name: '保定', value: 153},
                {name: '湘潭', value: 154},
                {name: '金华', value: 157},
                {name: '岳阳', value: 169},
                {name: '长沙', value: 175},
                {name: '衢州', value: 177},
                {name: '廊坊', value: 193},
                {name: '菏泽', value: 194},
                {name: '合肥', value: 229},
                {name: '武汉', value: 273},
                {name: '大庆', value: 279}
            ];
            var convertData = function (data) {
                var res = [];
                var mapCity = me.egeoCoordMap || geoCoordMap;
                for (var i = 0; i < data.length; i++) {
                    var geoCoord = mapCity[data[i].name];
                    if (geoCoord) {
                        res.push({
                            name: data[i].name,
                            value: geoCoord.concat(data[i].value)
                        });
                    }
                }
                return res;
            };

            var mapOption = {
                backgroundColor: '#404a59',
                title: {
                    text: '用户地理位置监控',
                    subtext: '实时数据',
                    left: 'left',
                    textStyle: {
                        color: '#fff'
                    }
                },

                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    orient: 'vertical',
                    y: 'bottom',
                    x: 'right',
                    data: me.elegendData || ['用户地理位置'],
                    textStyle: {
                        color: '#fff'
                    }
                },
                // 坐标网格设置
                grid: {
                    left: '0%',
                    right: '0%',
                    bottom: '0%',
                    containLabel: true
                },


                visualMap: me.evisualMap || {
                    // 连续型
                    type: 'continuous',
                    min: 0,
                    max: 500,
                    // 是否启用值域漫游
                    calculable: true,
                    inRange: {
                        color: ['#50a3ba', '#eac736', '#d94e5d', '#0055ff']
                    },
                    textStyle: {
                        color: '#fff'
                    }
                },
                geo: {
                    map: 'china',
                    label: {
                        emphasis: {
                            // 显示省份名称
                            show: true,
                            textStyle: {
                                color: '#000',
                                fontSize: 14
                            }
                        }
                    },
                    roam: true,
                    itemStyle: {
                        normal: {
                            areaColor: '#323c48',
                            borderColor: '#111'
                        },
                        emphasis: {
                            areaColor: '#2a333d'
                        }
                    }
                },
                series: [
                    {
                        name: '用户地理位置',
                        type: 'scatter',
                        coordinateSystem: 'geo',
                        data: convertData((me.exAxisData || data)),
                        symbolSize: function (val) {
                            return val[2] / 10;
                        },
                        label: {
                            normal: {
                                formatter: '{b}',
                                position: 'right',
                                show: false
                            },
                            emphasis: {
                                show: true
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: '#ddb926'
                            }
                        }
                    },
                    {
                        name: '投资人数量前5名',
                        type: 'effectScatter',
                        coordinateSystem: 'geo',
                        data: convertData((me.exAxisData || data).sort(function (a, b) {
                            return b.value - a.value;
                        }).slice(0, 6)),
                        symbolSize: function (val) {
                            return val[2] / 10;
                        },
                        showEffectOn: 'render',

                        rippleEffect: {
                            brushType: 'stroke'
                        },

                        hoverAnimation: true,

                        label: {
                            normal: {
                                formatter: '{b}',
                                position: 'right',
                                show: true
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: '#f4e925',
                                shadowBlur: 10,
                                shadowColor: '#333'
                            }
                        },
                        zlevel: 1
                    }
                ]
            };
            // 重置图表
            me.echarts.clear();
            me.echarts.setOption(mapOption, true);
        };

        return {
            restrict: 'AE',
            replace: false,
            scope: {
                source: '='
            },
            template: '<div>投资人地域分布图</div>',

            controller: ['$scope', '$interval', function ($scope, $interval) {
            }],

            controllerAs: 'mapScatterChartController',

            compile: function ($scope, element, attr) {

                // 获取图表的渲染位置
                var mapScatter = document.getElementById('echarts-mapScatter');
                // 初始化
                var me = me || {};
                // 初始化图表
                me.echarts = echarts.init(mapScatter);

                // 直接返回 link 函数
                return function ($scope, element, attr) {
                    $scope.$watch(
                        function ($scope) {
                            return $scope.source;
                        },
                        function () {
                            var data = $scope.source;
                            if (data && angular.isArray(data)) {
                                var self = me;
                                self.exAxisData = data;
                                echeartOption(self);
                            }
                        }, true);

                    $scope.resizeDom = function () {
                        return {
                            'height': mapScatter.offsetHeight,
                            'width': mapScatter.offsetWidth
                        };
                    };
                    $scope.$watch($scope.resizeDom, function () {
                        me.echarts.resize();
                    }, true);

                    // 渲染图表
                    echeartOption(me);
                }
            }
        };
    });
});
